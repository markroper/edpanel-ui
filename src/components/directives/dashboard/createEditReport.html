<div class="report-builder" layout="row" layout-wrap>
  <div flex="100" style="margin-top:3px;">
    <ul class="chart-types" flex="100"><li class="bar" ng-class="{selected: 'bar'==report.type.toLowerCase()}" ng-click="setReportType('BAR')">
        <md-tooltip>bar chart</md-tooltip>
      </li><li class="spline" ng-class="{selected: 'spline'==report.type.toLowerCase()}" ng-click="setReportType('SPLINE')">
        <md-tooltip>line chart</md-tooltip>
      </li><li class="scatterplot" ng-class="{selected: 'scatterplot'==report.type.toLowerCase()}" ng-click="setReportType('SCATTERPLOT')">
        <md-tooltip>scatter plot</md-tooltip>
      </li><li class="pie" ng-class="{selected: 'pie'==report.type.toLowerCase()}" ng-click="setReportType('PIE')">
        <md-tooltip>pie chart</md-tooltip></li></ul>
  </div>
  <div class="builder" layout="row" flex="100" layout-wrap>
    <div class="report-name-container" flex="100" layout="row" layout-align="center center">
      <div class="report-name" layout="row" layout-align="center center" flex="100">
        <md-input-container class="report-name" style="width:375px;">
          <label>Report name</label>
          <input class="md-headline" ng-model="report.name">
        </md-input-container>
      </div>
    </div>
    <div class="builder-container" layout="row" flex="100">
      <div class="y-axis" flex="25" layout="column" layout-align="start end">
        <md-input-container>
          <label>Choose axis data</label>
          <md-select ng-model="yData.table">
            <md-option ng-repeat= "opt in yOptions" value="{{opt}}">
              {{opt}}
            </md-option>
          </md-select>
        </md-input-container>
        <md-input-container>
          <label>aggregation (optional)</label>
          <md-select ng-model="yData.aggregation">
            <md-option ng-repeat="opt in aggregations" value="{{opt}}">
              {{opt}}
            </md-option>
          </md-select>
        </md-input-container>
      </div>
      <div class="x-axis" flex="75">
        <div class="x-container">
          <div class="svg-container">
            <div class="legend">
              <div class="md-body-2" style="margin-top:3px; margin-bottom:5px;">Legend</div>
              <md-input-container>
                <label>Series (optional)</label>
                <md-select ng-model="groupBy">
                  <md-option ng-repeat="opt in groupByOptions" value="{{opt}}">
                    {{opt}}
                  </md-option>
                </md-select>
              </md-input-container>
            </div>
            <div class="md-caption" style="position:absolute; bottom:0px; right:3px;">x-axis</div>
            <div class="md-caption" style="position:absolute; top:-15px; left:-20px;">y-axis</div>
          </div>
          <div layout="row" layout-align="center start">
            <div flex="60" layout="row" layout-align="start start" layout-wrap class="x-field-selector">
              <div flex="33">
                <div class="md-body-2 x-header">Table</div>
                <md-input-container>
                  <md-select ng-model="xData.table">
                    <md-option ng-repeat="opt in xOptions" value="{{opt}}">
                      {{opt}}
                    </md-option>
                  </md-select>
                </md-input-container>
              </div>
              <div flex="33">
                <div class="md-body-2 x-header">Field</div>
                <md-input-container>
                  <md-select ng-model="xData.field">
                    <md-option ng-repeat="opt in resolveTableFields(xData.table)" value="{{opt}}">
                      {{opt}}
                    </md-option>
                  </md-select>
                </md-input-container>
              </div>
              <div flex="33" ng-show="xData.aggregation">
                <div class="md-body-2 x-header">Aggregation</div>
                <div layout="row">
                  <md-input-container>
                    <md-select ng-model="xData.aggregation">
                      <md-option ng-repeat="opt in aggregations" value="{{opt}}">
                        {{opt}}
                      </md-option>
                    </md-select>
                  </md-input-container>
                  <md-button class="md-fab md-mini md-warn" md-theme="{{theme}}" ng-click="xData.aggregation = null">
                    <md-icon>remove</md-icon>
                    <md-tooltip>Remove aggregation</md-tooltip>
                  </md-button>
                </div>
              </div>
              <!-- OPTIONS MENU TO ADD GROUP BUCKETS OR AGGREGATE FUNCTIONS-->
              <md-fab-speed-dial md-open="xMenu.isOpen" md-direction="right" class="md-fling" flex="33" ng-show="!xData.aggregation || !xData.buckets">
                <md-fab-trigger>
                  <md-button aria-label="menu" md-theme="{{theme}}" class="md-fab md-primary md-mini">
                    <md-icon>menu</md-icon>
                    <md-tooltip>options menu</md-tooltip>
                  </md-button>
                </md-fab-trigger>
                <md-fab-actions>
                  <md-button class="md-fab md-mini md-primary" md-theme="{{theme}}" ng-click="addXAggregation(xData)">
                    <md-icon>add</md-icon>
                    <md-tooltip>Add aggregate (SUM, AVG, COUNT)</md-tooltip>
                  </md-button>
                  <md-button class="md-fab md-mini md-primary" md-theme="{{theme}}" ng-click="addBucket()">
                    <md-icon>group_work</md-icon>
                    <md-tooltip>Group results by range</md-tooltip>
                  </md-button>
              </md-fab-speed-dial>
            </div>
            <div ng-if="xData.buckets" layout="row" flex="40" layout-wrap layout-align="end center">
              <div layout="row" flex="100" class="bucket-header" layout-wrap>
                <div flex="100" class="md-body-2">Group Results</div>
                <div flex="25" class="md-caption">start</div>
                <div flex="25" class="md-caption">end</div>
                <div flex="25" class="md-caption">value</div>
                <div flex="25" class="md-caption"></div>
              </div>
              <div flex="100" layout="row" class="buckets" ng-repeat="bucket in xData.buckets">
                <md-input-container flex="25">
                  <input ng-model="bucket.start">
                </md-input-container>
                <md-input-container flex="25">
                  <input ng-model="bucket.end">
                </md-input-container>
                <md-input-container flex="25">
                  <input ng-model="bucket.label">
                </md-input-container>
                <md-button class="md-fab md-mini md-warn" md-theme="{{theme}}" ng-click="removeBucket(bucket)">
                  <md-icon>remove</md-icon>
                  <md-tooltip>Remove bucket</md-tooltip>
                </md-button>
              </div>
              <div flex="100" layout="row">
                <div flex="75"></div>
                <div flex="25">
                  <md-button class="md-fab md-mini md-primary" md-theme="{{theme}}" ng-click="addBucket()">
                    <md-icon>add</md-icon>
                    <md-tooltip>Add range</md-tooltip>
                  </md-button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div flex="100" layout="row" layout-align="center center" layout-wrap>
      <h3 flex="100" class="md-body-2" style="text-align:center; margin-top:0px; margin-bottom:0px;">Filters</h3>
      <expression-editor class="top-expression-editor" group="group" filterable-fields="filterableFields" filterable-tables="filterableTables" theme="theme"></expression-editor>
    </div>
  </div>
</div>
